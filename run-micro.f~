      PROGRAM runsuspect

!This program randomly scans the parameter space of a supersymmetric model using isajet

      real*8 mu,tgbeta,ma,m1,m2,m3,mhd2,mhu2
      real*8 mel,msl,mer,mtaur
      real*8 muq,msq,mur,mtr,mdr,mbr
      real*8 at,ab,atau,au,ad,al

      real*8 msusy,mz
      real*8 mu2a, mu2b,mu2

	integer t2,lsize,lsize1,lsize2,ncheck,flag,bBR
        real*8 msqmax,msqmin,msumax,msumin,mamax,mamin
        real*8 mumax,mumin,atmax,atmin,tbmax,tbmin

       real*8 m1a,m1amax,m1amin
       real*8 m2a,m2amax,m2amin

	integer r,p1
	real*8 l1,t1,l2
	integer p2
        real*8   msq3b,msu3b,mab,atb,mub,tanb
	real*8   msl3b,msd3b,mse3b


	real*8 inp(200000,8)

	call system("rm output-all-vars.dat")
	call system("rm suspect2_lha.out")
	call system("rm suspect2_lha.in")
	call system("rm temp.txt")

	call system("rm output-all-vars-feyn.dat")
	call system("rm output-all-vars-ds.dat")


	open(unit=14,file='rnd-pts.txt')

	open(17,file='f2.txt')
	open(26,file='output-all-vars.dat')

        testpt=0

        mz=91.187

! ranges
	msqmax=2000
	msqmin=0

	msumax=2000
	msumin=0

	mamax=1000
	mamin=0

        mumax=1000
	mumin=0

	atmax=4000
	atmin=-4000

	tbmax=60
	tbmin=2

	m1amax=1000
	m1amin=0

	m2amax=1000
	m2amin=0

!----------------------------------

	ncheck=0
        flag=0


	r=14
	p1=0

	call countl(r,p1)
        print *,"no. of random pts= ",p1

! read the point number to run from the folder name

       open(unit=25,file='run-pt.txt')
       read(25,*)p2

        print*,'running pt ',p2

! read rnd numbers

	do l1=1,p1

	t2=l1

	read(r,*)(inp(t2,t1),t1=1,8)

 	enddo
! start scan

! run loop

!	p2=2

	do l1=p2,p2+10  ! +100  !1,100  !p2,p2

!	do l1=1,5


	!write(*,*),'aa',(inp(l1,t1),t1=1,8)

	lsize1=2
	lsize2=0

        lsize=lsize1
        

111    continue

	do l2=0,lsize

	open(17,file='mssm-par.txt')


	print*,'loop nos.(l1,l2)=',l1,l2


 	if (l2.eq.0.and.flag.eq.0) then

	msq3b=inp(l1,1)
	msu3b=inp(l1,2)
	mab=inp(l1,3)
	tanb=inp(l1,4)
	mub=inp(l1,5)
	atb=inp(l1,6)
	m1a=inp(l1,7)
	m2a=inp(l1,8)

        flag=1

	else

	!write(*,*),'from file:',(inp(l1,t1),t1=1,8)





	call logdis(inp(l1,1),inp(l1,2),inp(l1,3),inp(l1,4)
     &,inp(l1,5),inp(l1,6),inp(l1,7),inp(l1,8),l2
     &,msq3b,msu3b,mab,tanb,mub,atb,m1a,m2a)
c
 	endif

        write(*,*),'from file:',(inp(l1,t1),t1=1,8)

       print*,'run-micro.F:msq3b,msu3b,mab,tanb,mub,atb,m1a,m2a'
       print*,msq3b,msu3b,mab,tanb,mub,atb,m1a,m2a



	       if(msq3b.ge.msqmax.or.msq3b.le.msqmin) then 
	 print*,'msq3b out of range ' 
	 goto 222 
	 endif

	     if(msu3b.ge.msumax.or.msu3b.le.msumin) then 
	 print*,'msu3b out of range ' 
	 goto 222 
	 endif

	     if(mab.ge.mamax.or.mab.le.mamin) then 
	 print*,'mab out of range ' 
	 goto 222 
	 endif

	     if(mub.ge.mumax.or.mub.le.mumin) then 
	 print*,'mub out of range ' 
	 goto 222 
	 endif

	     if(atb.ge.atmax.or.atb.le.atmin) then 
	 print*,'atb out of range ' 
	 goto 222 
	 endif

	     if(tanb.ge.tbmax.or.tanb.le.tbmin) then 
	 print*,'tanb out of range ' 
	 goto 222 
	 endif

	     if(m1a.ge.m1amax.or.m1a.le.m1amin) then 
	 print*,'m1a out of range ' 
	 goto 222 
	 endif

!----------------------------------------


        msusy=5000

      mu=mub

      mh3=mab   !msusy

      m1       = m1a  !msusy
      m2       = m2a  !msusy
      m3       = msusy  !msusy

!1st generation masses


	Mq1=msusy
	Mu1=msusy
	Md1=msusy

	Ml1=msq3b
	Mr1=msu3b


! 2nd generation masses


	Mq2=msusy
	Mu2=msusy
	Md2=msusy

	Ml2=msq3b
	Mr2=msu3b



!3rd generation masses


	Mq3=msusy
	Mu3=msusy
	Md3=msusy

	Ml3=msusy
	Mr3=msusy



	at=0
	ab=0
	atau=0
	

	Am=0

        tgbeta =  tanb


	 write(17,*),'mu',mu
	 write(17,*),'MG1',m1
	 write(17,*),'MG2',m2
	 write(17,*),'MG3',m3

	 write(17,*),'Ml1',Ml1
	 write(17,*),'Mr1',Mr1
	 write(17,*),'Mq1',Mq1
	 write(17,*),'Mu1',Mu1
	 write(17,*),'Md1',Md1


	 write(17,*),'Ml2',Ml2
	 write(17,*),'Mr2',Mr2
	 write(17,*),'Mq2',Mq2
	 write(17,*),'Mu2',Mu2
	 write(17,*),'Md2',Md2


	 write(17,*),'Ml3',Ml3
	 write(17,*),'Mr3',Mr3
	 write(17,*),'Mq3',Mq3
	 write(17,*),'Mu3',Mu3
	 write(17,*),'Md3',Md3


	 write(17,*),'At',at
	 write(17,*),'Ab',ab
	 write(17,*),'Al',atau

	 write(17,*),'MH3',MH3

	 write(17,*),'tb',tgbeta
	 write(17,*),'Am',Am


         close(17)



	open(unit=15,file='inp-params.txt')
      write(15,'((10(E14.7,2x)))'),msq3b,msu3b,mab,tanb,mub
     &,atb,m1a,m2a,l1,l2

         call system('./main mssm-par.txt')

         call system('./check-nan.sh')

         call system('./feyn.x suspect2_lha.out')

         call system('./dsmain < inp-ds.txt')


         call system('mv mssm-par.txt temp/mssm-par-temp.txt')
         call system('mv suspect2_lha.out  temp/suspect2_lha-temp.out')

      close(15)
      !close(17)


222	continue

       print*,'------------------------------------------'

	enddo

	enddo


         end

**************************************************************

	subroutine logdis(a,b,c,d,e,f,g,h,l2,msq3b,msu3b,mab
     &,tanb,mub,atb,m1a,m2a)

	real*8 a,b,c,d,e,f,g,h,msq3b,msu3b,mab,tanb,mub,atb,m1a,m2a,l2

        integer wi

        external ranlux
        real   rvec


        wi=5

        seed1=7654321

        seed=seed1+5*int(l2)

        print*,'l2=',l2

        !print *,'wi=',wi


        CALL RLUXGO(4,seed,0,0)


c       Now to generate a random number for msq

        CALL RNORMX(rvec,1,ranlux)
	msq3b=a+(a/wi*rvec)


c       Now to generate a random number for mhf 

        CALL RNORMX(rvec,1,ranlux)
	msu3b=b+(b/wi*rvec)

c       Now to generate a random number for a0 or N_mess

        CALL RNORMX(rvec,1,ranlux)
	mab=c+(c/wi*rvec)


c       Now to generate a random number for tgb 

        CALL RNORMX(rvec,1,ranlux)
	tanb=10  !d+(d/wi*rvec)


c       Now to generate a random number for tgb 

        CALL RNORMX(rvec,1,ranlux)
	mub=e+(e/wi*rvec)

c       Now to generate a random number for tgb 

        CALL RNORMX(rvec,1,ranlux)
	atb=f+(f/wi*rvec)

c       Now to generate a random number for tgb 

        CALL RNORMX(rvec,1,ranlux)
	m1a=g+(g/wi*rvec)

c       Now to generate a random number for tgb 

        CALL RNORMX(rvec,1,ranlux)
	m2a=h+(h/wi*rvec)

       !print*,'---',msq3b,msu3b,mab,tanb,mub,atb,m1a,m2a
!,a,b,c,d,e,f,g,h!

	end

*************************************************************

cc subroutine to count lines

           
	subroutine countl(r,p2)

	integer  io(41:51),p2,r

        do
        read (r,*,IOSTAT=io(r)) 
          if (io(r).lt.0) then 
           exit
         else
           p2=p2+1
         endif
        end do

	rewind r
	end

**************************************************************
